%
% Tikz Diagram
%

\begin{tikzpicture}

\tikzmath{
	\S = 0.7cm;
  \D = 5.5;
  \d = 1.6;
  \MAx = 0.5;
  \MBx = \MAx;
  \Maax = 0;
  \Mbbx = \Maax;
  \MAy = -1.6;
  \MBy = \MAy - \D;
  \Maay = \MAy + \d;
  \Mbby = \MBy + \d;
}

\tikzset{square matrix/.style={
    matrix of nodes,
    column sep=-\pgflinewidth, row sep=-\pgflinewidth,
    nodes={draw,
      minimum height=#1,
      anchor=center,
      text width=#1,
      align=center,
      inner sep=0pt
    },
  },
  square matrix/.default=\S
}

\matrix[square matrix] (mg1) at (\MAx,\MAy)
{
\phantom{} & \phantom{} & \phantom{} & \phantom{} \\
\phantom{} &|[preaction={fill, lightgray}, pattern=north west lines, pattern color=black]| \phantom{} & \phantom{} & \phantom{} \\
\phantom{} & \phantom{} & \phantom{} & \phantom{} \\
};
\matrix[square matrix] (m1) at (\Maax,\Maay)
{
|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} \\
|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} \\
|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} \\
};
\draw[opacity=.5, ultra thick, red] (m1-1-1.north west)-|
   (m1-3-3.south east)-|
   (m1-3-1.south west)-|cycle;
\draw [->, thick] (m1-2-2.center) -- (m1-1-1.center);
\draw [->, thick] (m1-2-2.center) -- (m1-1-2.center);
\draw [->, thick] (m1-2-2.center) -- (m1-1-3.center);
\draw [->, thick] (m1-2-2.center) -- (m1-2-1.center);
\draw [->, thick] (m1-2-2.center) -- (m1-2-3.center);
\draw [->, thick] (m1-2-2.center) -- (m1-3-1.center);
\draw [->, thick] (m1-2-2.center) -- (m1-3-2.center);
\draw [->, thick] (m1-2-2.center) -- (m1-3-3.center);

\matrix[square matrix] (mg2) at (\MBx,\MBy)
{
\phantom{} & \phantom{} & \phantom{} & \phantom{} \\
\phantom{} &|[preaction={fill, lightgray}, pattern=north west lines, pattern color=black]| \phantom{} &|[preaction={fill, lightgray}, pattern=north west lines, pattern color=black]| \phantom{} & \phantom{} \\
\phantom{} & \phantom{} & \phantom{} & \phantom{} \\
};
\matrix[square matrix] (m2) at (\Mbbx,\Mbby)
{
|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} \\
|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} \\
|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} &|[fill=white]| \phantom{} \\
};
\draw[opacity=.5, ultra thick, red] (m2-1-2.north west)-|
   (m2-3-4.south east)-|
   (m2-3-2.south west)-|cycle;
\draw [->, thick] (m2-2-3.center) -- (m2-1-2.center);
\draw [->, thick] (m2-2-3.center) -- (m2-1-3.center);
\draw [->, thick] (m2-2-3.center) -- (m2-1-4.center);
\draw [->, thick] (m2-2-3.center) -- (m2-2-2.center);
\draw [->, thick] (m2-2-3.center) -- (m2-2-4.center);
\draw [->, thick] (m2-2-3.center) -- (m2-3-2.center);
\draw [->, thick] (m2-2-3.center) -- (m2-3-3.center);
\draw [->, thick] (m2-2-3.center) -- (m2-3-4.center);

\node[text width=2cm] at (2.75,0) {$t = k$};
\node[text width=2cm] at (2.75,-5.5) {$t = k+1$};

\draw [->, double] (0,-3) -- (0,-4);

\end{tikzpicture}
