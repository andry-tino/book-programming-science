%
% Andrea Tino
% 2020
%
% =======================================================================
% Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International
% Public License
% =======================================================================
%

\begin{tikzpicture}

\tikzmath{
	\S = 0.7cm;
  \X1 = 0;
  \Y1 = 0;
  \Y2 = \Y1 - 1.2;
  \Y3 = \Y2 - 0.9;
  \Y4 = \Y3 - 0.9;
  \Yd = (\Y4 - \Y1) * 0.5;
  \Yy2 = \Y1 + \Yd;
  \Yy3 = \Yy2 + \Yd;
  \Yy4 = \Yy3 - 0.9;
  \X2 = -3.5;
  \Xx1 = \X1 + (\X2 - \X1) * 0.55;
  \X3 = -7;
  \Xx2 = \X2 + (\X3 - \X2) * 0.55;
  \Yf = \Y4 - 1.2;
}

\tikzset{square matrix/.style={
    matrix of nodes,
    column sep=-\pgflinewidth, row sep=-\pgflinewidth,
    nodes={draw,
      minimum height=#1,
      anchor=center,
      text width=#1,
      align=center,
      inner sep=0pt
    },
  },
  square matrix/.default=\S
}

\matrix[square matrix] (m1) at (\X1,\Y1)
{
$y_{1,1}$ & $y_{1,2}$ & $y_{1,3}$ \\
};

\matrix[square matrix] (m2) at (\X1,\Y2)
{
|[fill=black,text=white]| $y_{1,1}$ &|[fill=lightgray]| $y_{1,2}$ & $y_{1,3}$ \\
};
\draw[opacity=.5, ultra thick, red] (m2-1-1.north west)-|
   (m2-1-2.south east)-|
   (m2-1-1.south west)-|cycle;
\matrix[square matrix] (m3) at (\X1,\Y3)
{
$y_{1,1}$ &|[fill=black,text=white]| $y_{1,2}$ &|[fill=lightgray]| $y_{1,3}$ \\
};
\draw[opacity=.5, ultra thick, red] (m3-1-2.north west)-|
   (m3-1-3.south east)-|
   (m3-1-2.south west)-|cycle;
\matrix[square matrix] (m4) at (\X1,\Y4)
{
|[fill=lightgray]| $y_{1,1}$ & $y_{1,2}$ &|[fill=black,text=white]| $y_{1,3}$ \\
};
\draw[opacity=.5, ultra thick, red] (m4-1-3.north west)-|
   (m4-1-3.south east)-|
   (m4-1-3.south west)-|cycle;
\draw[opacity=.5, ultra thick, red] (m4-1-1.north west)-|
   (m4-1-1.south east)-|
   (m4-1-1.south west)-|cycle;

\node[] at (\X1,\Yf) {(Neighborhoods)};

%%%

\matrix[square matrix] (m5) at (\X2,\Y1)
{
$y_{1,1}$ &|[fill=black,text=white]| $y_{1,2}$ & $y_{1,3}$ \\
};

\matrix[square matrix] (m6) at (\X2,\Yy2)
{
|[fill=black,text=white]| $y_{1,1}$ & $y_{1,2}$ & $y_{1,3}$ \\
};

\matrix[square matrix] (m7) at (\X2,\Yy3)
{
$y_{1,1}$ & $y_{1,2}$ &|[fill=black,text=white]| $y_{1,3}$ \\
};

\draw [->, thick] (m5-1-2.south) -- (m6-1-2.north);
\draw [->, thick] (m6-1-2.south) -- (m7-1-2.north);
\draw [->, thick] (m7-1-2.south) -- (\X2,\Yy4) -- (\Xx1,\Yy4) -- (\Xx1,\Y1) -- (m5-1-3.east);

\node[] at (\X2,\Yf) {(a)};

%%%

\matrix[square matrix] (m8) at (\X3,\Y1)
{
$y_{1,1}$ &|[fill=black,text=white]| $y_{1,2}$ & $y_{1,3}$ \\
};

\matrix[square matrix] (m9) at (\X3,\Yy2)
{
|[fill=black,text=white]| $y_{1,1}$ &|[fill=black,text=white]| $y_{1,2}$ & $y_{1,3}$ \\
};

\matrix[square matrix] (mm1) at (\X3,\Yy3)
{
|[fill=black,text=white]| $y_{1,1}$ &|[fill=black,text=white]| $y_{1,2}$ &|[fill=black,text=white]| $y_{1,3}$ \\
};

\draw [->, thick] (m8-1-2.south) -- (m9-1-2.north);
\draw [->, thick] (m9-1-2.south) -- (mm1-1-2.north);
\draw [->, thick] (mm1-1-2.south) -- (\X3,\Yy4) -- (\Xx2,\Yy4) -- (\Xx2,\Yy3) -- (mm1-1-3.east);

\node[] at (\X3,\Yf) {(b)};

\end{tikzpicture}
